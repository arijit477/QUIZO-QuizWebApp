<div class="modern-profile-container" *ngIf="user">
  <!-- Header Section -->
  <div class="profile-header">
    <div class="profile-avatar">
      <div class="avatar-container">
        <img
          class="profile-img"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='40' r='30' fill='%23007bff'/%3E%3Ccircle cx='50' cy='100' r='40' fill='%23f8f9fa'/%3E%3C/svg%3E"
          alt="{{user.firstName}} {{user.lastName}}"
        />
        <div class="status-indicator" [class.active]="user.enabled"></div>
      </div>
      <h1 class="user-name">{{user.firstName}} {{user.lastName}}</h1>
      <p class="user-role">{{user.authorities[0].authority}}</p>
    </div>

    <!-- Sample Data Indicator -->
    <div class="sample-data-indicator" *ngIf="isSampleData">
      <span class="sample-badge">üìã Sample Data</span>
      <p class="sample-hint">This is demonstration data. Log in to see your actual progress.</p>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button class="tab-btn" [class.active]="activeTab === 'overview'" (click)="switchTab('overview')">Overview</button>
    <button class="tab-btn" [class.active]="activeTab === 'progress'" (click)="switchTab('progress')">Progress</button>
    <button class="tab-btn" [class.active]="activeTab === 'achievements'" (click)="switchTab('achievements')">Achievements</button>
    <button class="tab-btn" [class.active]="activeTab === 'history'" (click)="switchTab('history')">History</button>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Overview Tab -->
    <div class="tab-pane" [class.active]="activeTab === 'overview'" id="overview">
      <div class="info-grid">
        <div class="info-card">
          <div class="info-icon">üë§</div>
          <div class="info-content">
            <h3>Username</h3>
            <p>{{user.username}}</p>
          </div>
        </div>

        <div class="info-card">
          <div class="info-icon">üÜî</div>
          <div class="info-content">
            <h3>User ID</h3>
            <p>QUIZO{{user.id}}</p>
          </div>
        </div>

        <div class="info-card">
          <div class="info-icon">üìû</div>
          <div class="info-content">
            <h3>Phone</h3>
            <p>{{user.phone || 'Not provided'}}</p>
          </div>
        </div>

        <div class="info-card">
          <div class="info-icon">üîí</div>
          <div class="info-content">
            <h3>Status</h3>
            <p [class.status-active]="user.enabled" [class.status-inactive]="!user.enabled">
              {{user.enabled ? 'ACTIVE' : 'INACTIVE'}}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Tab -->
    <div class="tab-pane" [class.active]="activeTab === 'progress'" id="progress">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìä</div>
          <div class="stat-content">
            <h3>Total Quizzes</h3>
            <p class="stat-number">{{progressSummary.totalQuizzes || 0}}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">‚≠ê</div>
          <div class="stat-content">
            <h3>Average Score</h3>
            <p class="stat-number">{{progressSummary.averageScore || '0.00'}}%</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üèÜ</div>
          <div class="stat-content">
            <h3>Best Score</h3>
            <p class="stat-number">{{progressSummary.bestScore ? progressSummary.bestScore.toFixed(2) + '%' : '0.00%'}}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">‚è∞</div>
          <div class="stat-content">
            <h3>Time Spent</h3>
            <p class="stat-number">{{progressSummary.totalTimeSpent ? progressService.formatTimeSpent(progressSummary.totalTimeSpent) : '00:00:00'}}</p>
          </div>
        </div>
      </div>

      <!-- Performance Breakdown -->
      <div class="performance-section">
        <div class="performance-card">
          <h3>Performance by Category</h3>
          <div class="performance-list" *ngIf="progressSummary.categoryStats && getCategoryKeys().length > 0">
            <div class="performance-item" *ngFor="let category of getCategoryKeys()">
              <span class="category-name">{{category}}</span>
              <div class="performance-bar">
                <div class="bar-fill" [style.width.%]="progressSummary.categoryStats[category].average"></div>
              </div>
              <span class="performance-value">{{progressSummary.categoryStats[category].average.toFixed(2)}}%</span>
            </div>
          </div>
          <p class="no-data" *ngIf="getCategoryKeys().length === 0">No category data available</p>
        </div>

        <div class="performance-card">
          <h3>Performance by Difficulty</h3>
          <div class="performance-list" *ngIf="progressSummary.difficultyStats && getDifficultyKeys().length > 0">
            <div class="performance-item" *ngFor="let difficulty of getDifficultyKeys()">
              <span class="difficulty-name">{{difficulty}}</span>
              <div class="performance-bar">
                <div class="bar-fill" [style.width.%]="progressSummary.difficultyStats[difficulty].average"></div>
              </div>
              <span class="performance-value">{{progressSummary.difficultyStats[difficulty].average.toFixed(2)}}%</span>
            </div>
          </div>
          <p class="no-data" *ngIf="getDifficultyKeys().length === 0">No difficulty data available</p>
        </div>
      </div>

      <!-- Data Management Section -->
      <div class="data-management-section">
        <h3>Data Management</h3>
        <div class="data-actions">
          <button class="data-btn export-btn" (click)="exportProgress()">
            <span class="btn-icon">üì§</span>
            Export Progress
          </button>
          <label class="data-btn import-btn" for="import-file">
            <span class="btn-icon">üì•</span>
            Import Progress
            <input type="file" id="import-file" accept=".json" (change)="importProgress($event)" style="display: none;">
          </label>
          <button class="data-btn clear-btn" (click)="clearAllProgress()">
            <span class="btn-icon">üóëÔ∏è</span>
            Clear All Data
          </button>
        </div>
        <p class="data-hint">Export your progress data for backup or transfer to another device. Import previously exported data to restore your progress.</p>
      </div>

      <!-- Progress Chart Section -->
      <div class="progress-chart-section" *ngIf="activeTab === 'progress'">
        <app-progress-chart></app-progress-chart>
      </div>
    </div>

    <!-- Achievements Tab -->
    <div class="tab-pane" [class.active]="activeTab === 'achievements'" id="achievements">
      <app-achievements></app-achievements>
    </div>

    <!-- History Tab -->
    <div class="tab-pane" [class.active]="activeTab === 'history'" id="history">
      <div class="history-header">
        <h3>Quiz History</h3>
        <div class="history-summary">
          <span class="total-quizzes">Total Attempts: {{allProgress.length}}</span>
        </div>
      </div>

      <div class="history-content">
        <div class="quiz-history" *ngIf="allProgress.length > 0">
          <div class="quiz-item" *ngFor="let progress of allProgress; trackBy: trackByQuizId">
            <div class="quiz-header">
              <div class="quiz-title-section">
                <h4 class="quiz-title">{{progress.quizTitle || 'Quiz #' + progress.quizId}}</h4>
                <div class="quiz-badges">
                  <span class="badge category-badge" *ngIf="progress.category">{{progress.category}}</span>
                  <span class="badge difficulty-badge" *ngIf="progress.difficulty">{{progress.difficulty}}</span>
                </div>
              </div>
              <div class="quiz-date">
                <span class="date-icon">üìÖ</span>
                {{progress.date | date:'short'}}
              </div>
            </div>

            <div class="quiz-details">
              <div class="quiz-stats-grid">
                <div class="stat-item">
                  <div class="stat-label">Score</div>
                  <div class="stat-value score-value">{{(progress.score / progress.maxScore * 100).toFixed(1)}}%</div>
                  <div class="stat-detail">{{progress.score}}/{{progress.maxScore}}</div>
                </div>

                <div class="stat-item" *ngIf="progress.timeSpent">
                  <div class="stat-label">Time Spent</div>
                  <div class="stat-value">{{progressService.formatTimeSpent(progress.timeSpent)}}</div>
                  <div class="stat-detail">Duration</div>
                </div>

                <div class="stat-item">
                  <div class="stat-label">Quiz ID</div>
                  <div class="stat-value">#{{progress.quizId}}</div>
                  <div class="stat-detail">Reference</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="no-data" *ngIf="allProgress.length === 0">
          <div class="no-data-icon">üìù</div>
          <h4>No Quiz Attempts Yet</h4>
          <p>Start your first quiz to see your progress and history here!</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="action-btn primary" (click)="updateProfile()">
      <span class="btn-icon">‚úèÔ∏è</span>
      Update Profile
    </button>
    <button class="action-btn secondary" (click)="shareProfile()">
      <span class="btn-icon">üì§</span>
      Share Profile
    </button>
  </div>
</div>
